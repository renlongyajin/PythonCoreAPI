# 下一步开发计划

## 目标：强化用户登录鉴权与权限管控，确保后台稳定且易扩展

1. **RBAC 依赖与管理接口守卫**
   - 先编写 `tests/api/test_auth_permissions.py`，覆盖普通用户访问管理员接口得到 403、管理员成功访问等场景。
   - 基于 FastAPI 依赖实现 `require_roles`/`require_active_user`，在 `app/apps/auth/router.py` 中为 `/register` 等路由加守卫，同时保证测试先行。

2. **Token 吊销与刷新策略**
   - 以测试驱动新增 `tests/api/test_token_revocation.py`，校验注销后旧 Token 失效、刷新接口拒绝黑名单 Token。
   - 设计 `TokenBlacklistRepository`（初期可用内存/数据库实现），在 `AuthService` 中接入注销与刷新逻辑，确保幂等并记录时间戳。

3. **登录安全与审计可观测性**
   - 编写集成测试验证登录失败次数超阈值被暂时封禁、成功登录写入审计日志。
   - 引入轻量中间件/服务记录登录轨迹与失败次数，暴露结构化日志字段，为后续扩展（限流、告警）留钩子。
